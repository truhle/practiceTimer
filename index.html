<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="UTF-8">
  <title>Practice Timer</title>
</head>
<body style="background: white; height: 100%">
  <div style="height: 100%">
    <g style="height: 100%">
      <svg xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height="100%" viewbox="0 0 500 500">
        <defs>
          <radialGradient id="round" cx="50%" cy="300%" fx="40%" fy="80%"
          r="295%" spreadMethod="pad">
            <stop offset="0%" style="stop-color:white; stop-opacity:0" />
            <stop id="opaqueStop" offset="100%" style="stop-color:white; stop-opacity:1" />
          </radialGradient>
        </defs>

        <image x="0" y="0" width="100%" height="100%"
          xlink:href="enso.svg" />

        <rect x="257.9" y="17.88" width="80" height="80"
          style="fill:url(#round);
          stroke: none;"
          transform="rotate(-84, 297.9, 57.88)" />

        <!-- circle diameter: 1244 -->
        <circle cx="250" cy="250" r="198" style="stroke: white; fill: none;
          stroke-width: 65; stroke-opacity: 1; stroke-dasharray: 1218;
          stroke-dashoffset: 0;" transform="rotate(-78.75,250,250)" />

      </svg>
    </g>
  </div>

  <script type="text/javascript">
    var mins = 2, duration = mins * 60000,
        primaryTime = duration * 0.954,
        ending = duration - primaryTime,
        lastTime = null, shortDur = false;

    var pause = false;

    var angle = -84, radians = (angle + 8) * (Math.PI / 180),
        angleSweep = 343.5, sweepRadians = angleSweep * (Math.PI / 180),
        dashOffset = 0, dashSweep = 1187,
        radius = 198;

    var angleIncr = angleSweep / primaryTime,
        radianIncr = sweepRadians / primaryTime,
        dashIncr = dashSweep / primaryTime;

    var rect = document.querySelector("rect"),
        circle = document.querySelector("circle");
        stop = document.getElementById("opaqueStop")

    function animate(time) {
      if (duration <= 0) {
        return;
      }
      else if (lastTime != null) {
        elapsed = time - lastTime;
        angle -= angleIncr * elapsed;
        radians -= radianIncr * elapsed;
        dashOffset += dashIncr * elapsed;
        duration -= elapsed;
      }
      lastTime = time;

      if (duration >= ending) {
        var x = 210 + Math.cos(radians) * radius,
        y = 210 + Math.sin(radians) * radius,
        transfX = x + 40,
        transfY = y + 40,
        transform = "rotate(" + angle + "," + transfX + "," + transfY + ")";
        rect.setAttribute("x", x);
        rect.setAttribute("y", y);
        rect.setAttribute("transform", transform);
        circle.style['stroke-dashoffset'] = dashOffset;
      }
      else if (duration < ending) {
        var opacity = duration / ending;
        stop.style["stop-opacity"] = opacity;
      }
      if (shortDur == true)
        requestAnimationFrame(animate)
    }

    function runFPS(fpsInterval) {
      setInterval(function() {
        if (duration > 0 && pause == false)
          requestAnimationFrame(animate)
      }, fpsInterval);
    }

    function setFPS(duration) {
      var secs = duration / 1000, mins = secs / 60, fps = 45;
      if (secs < 120)
        shortDur = true;
      else {
        shortDur = false;
        if (mins <= 5)
          fps = Math.ceil(45 - ((mins - 2) * 5) );
        else if (mins <= 10)
          fps = Math.ceil(30 - ((mins - 5) * 2) );
        else if (mins > 10 && mins <= 15)
          fps = 20;
        else if (mins < 20)
          fps = Math.ceil(20 - ((mins - 15) * 2));
        else if (mins < 30)
          fps = mins < 25 ? 6 : 4;
        else
          fps = 2;
      }
      return fps;
    }

    var fps = setFPS(duration);
    var fpsInterval = Math.ceil(1000 / fps);

    if (shortDur == false)
      runFPS(fpsInterval);
    else
      requestAnimationFrame(animate);

  </script>
</body>
</html>
